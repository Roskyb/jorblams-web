---
// Header & Navigation UI displayed on each page.

import { getRelativeLocaleUrl } from "astro:i18n";
import { LOCALES, type Lang, useTranslations } from "@/i18n";
const t = useTranslations(Astro.currentLocale as Lang);

const locale = Astro.currentLocale as Lang;

// Get current path without locale
const currentPath = Astro.url.pathname.split("/").slice(2).join("/");
---

<!-- Navigation Bar -->
<nav class="fixed top-0 left-0 right-0 z-[100] px-8 py-6 border-b border-white/10 bg-black">
  <div class="flex items-center justify-between">
    <!-- Language Selector -->
    <div class="relative">
      <button id="langButton" class="flex items-center gap-2 text-white hover:text-amber-200 transition-colors p-2 -ml-2" aria-label="Select language">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="2" y1="12" x2="22" y2="12"></line>
          <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
        </svg>
        <span class="text-sm font-medium uppercase">{locale}</span>
      </button>
      
      <!-- Language Dropdown -->
      <div id="langDropdown" class="absolute top-full left-0 mt-2 bg-neutral-900 border border-white/10 rounded-lg shadow-xl opacity-0 pointer-events-none transition-opacity duration-200 min-w-[120px]">
        {Object.entries(LOCALES).map(([lang, { label }]) => (
          <a
            href={`/${lang}/${currentPath}`}
            class={`block px-4 py-2 text-sm text-white hover:bg-neutral-800 hover:text-amber-200 transition-colors first:rounded-t-lg last:rounded-b-lg ${lang === locale ? 'bg-neutral-800 text-amber-200' : ''}`}
          >
            {label}
          </a>
        ))}
      </div>
    </div>

    <!-- Menu Button -->
    <button id="menuButton" class="text-white hover:opacity-70 transition-opacity p-2 -mr-2" aria-label="Open menu">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
  </div>
</nav>

<!-- Drawer Overlay -->
<div id="drawerOverlay" class="fixed inset-0 bg-black/50 z-60 opacity-0 pointer-events-none transition-opacity duration-300"></div>

<!-- Drawer Menu -->
<div id="drawer" class="fixed top-0 right-0 h-full w-full md:w-1/2 bg-neutral-900 z-70 transform translate-x-full transition-transform duration-300 ease-in-out">
  <div class="flex flex-col h-full p-8">
    <!-- Close Button -->
    <div class="flex justify-end mb-12">
      <button id="closeButton" class="text-white hover:opacity-70 transition-opacity p-2" aria-label="Close menu">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>

    <!-- Menu Links -->
    <nav class="flex flex-col gap-6">
      <a href={getRelativeLocaleUrl(locale, "/")} class="menu-link text-white text-6xl font-medium hover:text-amber-200 hover:scale-110 transition-all duration-200 origin-left">
        {t({ en: "Home", es: "Inicio" })}
      </a>
      <a href={getRelativeLocaleUrl(locale, "/about")} class="menu-link text-white text-6xl font-medium hover:text-amber-200 hover:scale-110 transition-all duration-200 origin-left">
        {t({ en: "About", es: "Acerca de" })}
      </a>
      <a href={getRelativeLocaleUrl(locale, "/blog")} class="menu-link text-white text-6xl font-medium hover:text-amber-200 hover:scale-110 transition-all duration-200 origin-left">
        {t({ en: "Blog", es: "Blog" })}
      </a>
    </nav>

    <!-- Footer Section -->
    <div class="mt-auto pt-12">
      <div class="grid grid-cols-3 gap-8 text-sm">
        <div>
          <h3 class="text-white font-medium mb-4">{t({ en: "About", es: "Acerca de" })}</h3>
          <p class="text-gray-400 text-xs leading-relaxed">
            {t({ en: "Full-stack developer passionate about creating modern web applications with TypeScript.", es: "Desarrollador full-stack apasionado por crear aplicaciones web modernas con TypeScript." })}
          </p>
        </div>
        <div>
          <h3 class="text-white font-medium mb-4">{t({ en: "Projects", es: "Proyectos" })}</h3>
          <ul class="space-y-2">
            <li><a href={getRelativeLocaleUrl(locale, "/#projects")} class="text-gray-400 text-xs underline hover:text-amber-200 underline-offset-4 transition-all duration-200">{t({ en: "View All", es: "Ver Todos" })}</a></li>
            <li><a href="https://github.com/roskyb" target="_blank" rel="noopener noreferrer" class="text-gray-400 text-xs underline hover:text-amber-200 underline-offset-4 transition-all duration-200">GitHub</a></li>
            <li><a href="https://www.npmjs.com/~roskyb" target="_blank" rel="noopener noreferrer" class="text-gray-400 text-xs underline hover:text-amber-200 underline-offset-4 transition-all duration-200">NPM</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-white font-medium mb-4">{t({ en: "Connect", es: "Conectar" })}</h3>
          <ul class="space-y-2">
            <li><a href="mailto:jorge.blanco.gil.00@gmail.com" class="text-gray-400 text-xs underline hover:text-amber-200 underline-offset-4 transition-all duration-200">{t({ en: "Email", es: "Email" })}</a></li>
            <li><a href="https://www.linkedin.com/in/jorge-blanco-gil-b715182a6/" target="_blank" rel="noopener noreferrer" class="text-gray-400 text-xs underline hover:text-amber-200 underline-offset-4 transition-all duration-200">LinkedIn</a></li>
            <li><a href="https://github.com/roskyb" target="_blank" rel="noopener noreferrer" class="text-gray-400 text-xs underline hover:text-amber-200 underline-offset-4 transition-all duration-200">GitHub</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Drawer Menu
  const menuButton = document.getElementById('menuButton');
  const closeButton = document.getElementById('closeButton');
  const drawer = document.getElementById('drawer');
  const drawerOverlay = document.getElementById('drawerOverlay');

  function openDrawer() {
    drawer?.classList.remove('translate-x-full');
    drawerOverlay?.classList.remove('opacity-0', 'pointer-events-none');
    document.body.style.overflow = 'hidden';
  }

  function closeDrawer() {
    drawer?.classList.add('translate-x-full');
    drawerOverlay?.classList.add('opacity-0', 'pointer-events-none');
    document.body.style.overflow = '';
  }

  function toggleDrawer() {
    const isOpen = !drawer?.classList.contains('translate-x-full');
    if (isOpen) {
      closeDrawer();
    } else {
      openDrawer();
    }
  }

  menuButton?.addEventListener('click', toggleDrawer);
  closeButton?.addEventListener('click', closeDrawer);
  drawerOverlay?.addEventListener('click', closeDrawer);

  // Close drawer on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeDrawer();
      closeLangDropdown();
    }
  });

  // Language Dropdown
  const langButton = document.getElementById('langButton');
  const langDropdown = document.getElementById('langDropdown');

  function openLangDropdown() {
    langDropdown?.classList.remove('opacity-0', 'pointer-events-none');
  }

  function closeLangDropdown() {
    langDropdown?.classList.add('opacity-0', 'pointer-events-none');
  }

  langButton?.addEventListener('click', (e) => {
    e.stopPropagation();
    const isOpen = !langDropdown?.classList.contains('opacity-0');
    if (isOpen) {
      closeLangDropdown();
    } else {
      openLangDropdown();
    }
  });

  // Close dropdown when clicking outside
  document.addEventListener('click', (e) => {
    if (!langButton?.contains(e.target as Node) && !langDropdown?.contains(e.target as Node)) {
      closeLangDropdown();
    }
  });

</script>

<style>
  .menu-link {
    font-weight: 500;
    transition: font-weight 0.2s ease, color 0.2s ease, transform 0.2s ease;
  }

  .menu-link:hover {
    font-weight: 900;
    letter-spacing: -0.02em;
  }
</style>
